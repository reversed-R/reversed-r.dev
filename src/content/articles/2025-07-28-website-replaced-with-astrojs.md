---
title: "Next.js意味ないのでAstro.jsで置き換えた"
date: "2025-07-28"
description: "更新しないブログ、意味ない"
tags: ["Web", Astro.js", "Next.js", "Markdown", "GitHub Actions", "Portainer"]
---

こんにちは、ゃーです。

本ページは昨年(2024年)末に[Next.js](https://nextjs.org/)で作られていました。
(某インズアドベントカレンダーで記事を書く先にするため、ということもあった。その時に書いた記事は[これ](/articles/2024-12-02-website-hosted-with-nextjs))

しかしながら、Next.jsって意味ないんですね、これが。
正確に言うと(後述しますが)、一般に意味ない場面もありつつも、特に本ページのような場面に置いては本当に意味がないです。

なので、今回は[Astro.js](https://astro.build/)で置き換えました。
まあ、置き換えという行為自体があんま意味ないんですが。

# Next.jsが意味ない場合

一般の場合と本ページの場合があるので分けて書きます。

## 本ページの場合

- 静的ページである

  本ページは、ホームページという静的な役割しか担っていません。
  Next.jsはフロントとバックエンドが同じ言語で同時に書けて嬉しいね、というのがメインの主張なはずなので、静的なページにおいては誤った選択肢と言えるでしょう。
  よくわからんけど、Nextってやつみんな使ってるし意味があるだろうと思って選択したのが誤りでした。ケースにあっていない。

  ブログの記事は更新されますが、記事を書いたときにビルドすればいいだけです。
  Next.jsが備えるSSR(Server Side Rendering)というのはアクセスした瞬間に必要に応じてhtmlをビルドします(すでにビルド済みで差分がないためキャッシュをそのまま出す場合もある(多分))が、
  これが意味あるのはバックエンドから取得できるデータをその場でhtmlに埋め込んでしまえばブラウザからフロントサーバ間とブラウザからバックサーバ間の2往復をしなくて済むという点においてだと思われます。
  ブログの記事なんかは静的にビルドしておいてアクセスしたときにhtmlとればいいんです。
  NextというかReactの話になりますが、ブラウザまでjsをぶん投げて手元でDOMを構築する意味もない。

- セルフホストしたい

Next.jsは開発元であるところの[Vercel](https://vercel.com/)にデプロイすることを前提にしすぎているのか、セルフホストする情報が少なかった記憶があります。
まあ別にnodeがそのままサーバをやるだけだし、Dockerコンテナに入れていたし、大したことはないのですが。

## 一般の場合

どうせですし一般の場合も書いておきます。

- デプロイ先問題

先程触れたようにVercelにベンダーロックインされるのは普通に渋いでしょう。

で、他のデプロイ先を探したときに、静的ページの配信を行うサービスはよくあり、Next.jsはnodeのランタイムがそのままサーバをやるので静的ではなく、載りません。

私はさまざまにCloudflareなどをよく使っていますが、その場合無理やり静的にビルドしてしまうという方法もあり、Cloudflare Pagesなどは[cloudflare/next-on-pages](https://github.com/cloudflare/next-on-pages)などというものも提供されていました。
しかしこれもCloudflareがそもそもPagesのサポートをやめてしまいWorkersに統合、[OpenNext.js](https://opennext.js.org/)という互換性があるのかいつ開発が終わってしまうのかわからないオープン実装を使ってどうにかするというスタイルに変わっていくようです。
また、そもそも静的にビルドされる時点でNext.jsの旨味はありません。

セルフホストという方法もありますが...日本の企業でそこまでやる気があるケースはかなり限られるかな、と。

- そもそもフロントとバックを統合することに旨味はない

  役割が別だからです。
  開発も別の機能が混在するのはやりづらいと思います。
  フロントとバックがそれぞれなんなのかをわかっていないで学習が進んでしまい初学者の学習コストも高いでしょう。

  バックエンドはWeb APIとしてさまざまなところから呼び出し可能な方が良いです。
  PHPに逆戻りだと思います。

- ルーティングってやつも近頃はどうにかなる

Reactを普通に使おうと思うとSPAとして始まったこともありルーティングができません。
そこでNextを選ぶということもあるかもしれませんが、近頃はReact Routerだの[TanStack Router](https://tanstack.com/router/latest)だのあり、どうにでもなりそうです。

# ということでAstro.jsにした

Astro.jsは、比較的かなりJavaScriptのコードを書かないことに注力しています。
ほぼHTMLそのものだと言って良い。
コンポーネントを使えるとかTypeScriptを使えるとかNodeであるみたいな旨味だけ吸って静的ページを作るのに必要十分くらいの構成になっているようです。
あと、Markdownなどのページ(HTML)へのビルドが組み込みなのも良いですね、ブログには。

別にAstro.jsが決定的なソリューションになるとは思いません(そもそもソフトウェアが決定的なソリューションになるケースは限られると考えます)が、
静的ページを作るのには順当に良いでしょう。

書き換え自体がそんなに意味ないのですが、

- そもそも元のNextがユースケースを誤りすぎてるからさっさとリプレイスしようとは思っていた
- そのため記事更新用のCDなどのロジックも必要なのに追加で整備しなかった
- 更新しないブログって意味ないので更新しようと思った
- セキュキャンってやつが迫っており雑なホームページをお見せできないなと思った
- 去年よりはパソコンをしており去年ほど手探りではなくなったので爆速でできるだろうと思った
  - 数ヶ月前にAstroでMarkdownビルドページ付きのページを作ったため、Astro.js V5ってやつの*Content Collection*とかいうのもまあ知っていた
- あと近頃はLLMってやつに聞くとそれなりにすぐできる

ために、さっさとリプレイスしました。
他のこともしつつ3日くらいで終わった。

## CDも整備した

_Continuous Deployment_、かっこよという感じですが、ただのGitHub Actionsです。

そもそも、本ページは超適当サーバの上で[Portainerくん](https://www.portainer.io/)に突かれながら動いているDockerコンテナでしかないです。
PortainerはCDのためのWebfookなどもありますがEnterprise機能ですし、*GitOps update*と書かれているのもGitリポジトリの指定された`compose.yaml`を指定した間隔で見に行き差分があればリデプロイするだけです。
(なので、[workflows/deploy.yaml](https://github.com/reversed-R/reversed-r.dev/)には差分を生み出すためにタイムスタンプを挿入するという嘘みたいなステップがある)

さっさとこの嘘みたいな環境はやめたいです。
何個か使えるマシンや場所はあるのでさっさとKubernetesに載せてついでにArgo CDなども整備したいところですが...

# 終わりと、ついでに

さっさとk8sクラスタ整備したいみたいな夢を語ったことですし、このようなゴミのトラフィックをパブリックインターネットに垂れ流すついでにこの夏やるつもりのことでも列挙しておこうかと思います。

- セキュキャンCコンパイラ自作ゼミ

  これは決定しています。すでに[Cコンパイラ書きまくり](https://github.com/reversed-R/ya-cc/)。

- TCP/IPプロトコル・スタック一気に駆け上がる

  やっぱり自分で書かないとよくわからんなと思ったので。

- ラックサーバをしばく

  NEC Express 5800 R120-g を買うだけ買ってしばいてないので。

- k8sクラスタ整備する

  ラックサーバとゴミのパソコンいくつかを組み合わせます。

- メールサーバ立てる

  メールってやつ意味あるので。

- hedgedocとかも載せる

  ちょうどいいメモ帳を探しています。

そんなわけです。では、また。
